{"version":3,"sources":["../src/actions.js"],"names":["define","$","Ajax","Notification","Str","Templates","Url","ModalFactory","ModalEvents","ACTIONS","RENAME_CONTENT","Actions","registerEvents","prototype","click","e","preventDefault","contentname","data","contentid","saveButtonText","get_strings","key","component","then","langStrings","modalTitle","create","title","body","render","type","types","SAVE_CANCEL","modal","setSaveButtonText","getRoot","on","save","newname","val","renameContent","hidden","destroy","show","catch","exception","name","requestType","call","methodname","args","get_string","message","params","id","statusmsg","errormsg","window","location","href","relativeUrl"],"mappings":"AAuBAA,OAAM,4BAAC,CACH,QADG,CAEH,WAFG,CAGH,mBAHG,CAIH,UAJG,CAKH,gBALG,CAMH,UANG,CAOH,oBAPG,CAQH,mBARG,CAAD,CASN,SAASC,CAAT,CAAYC,CAAZ,CAAkBC,CAAlB,CAAgCC,CAAhC,CAAqCC,CAArC,CAAgDC,CAAhD,CAAqDC,CAArD,CAAmEC,CAAnE,CAAgF,IAOxEC,CAAAA,CAAO,CAAG,CACVC,cAAc,CAAE,iCADN,CAP8D,CAcxEC,CAAO,CAAG,UAAW,CACrB,KAAKC,cAAL,EACH,CAhB2E,CAqB5ED,CAAO,CAACE,SAAR,CAAkBD,cAAlB,CAAmC,UAAW,CAC1CX,CAAC,CAACQ,CAAO,CAACC,cAAT,CAAD,CAA0BI,KAA1B,CAAgC,SAASC,CAAT,CAAY,CACxCA,CAAC,CAACC,cAAF,GADwC,GAGpCC,CAAAA,CAAW,CAAGhB,CAAC,CAAC,IAAD,CAAD,CAAQiB,IAAR,CAAa,aAAb,CAHsB,CAIpCC,CAAS,CAAGlB,CAAC,CAAC,IAAD,CAAD,CAAQiB,IAAR,CAAa,WAAb,CAJwB,CAiBpCE,CAAc,CAAG,EAjBmB,CAkBxChB,CAAG,CAACiB,WAAJ,CAZc,CACV,CACIC,GAAG,CAAE,eADT,CAEIC,SAAS,CAAE,kBAFf,CADU,CAKV,CACID,GAAG,CAAE,QADT,CAEIC,SAAS,CAAE,kBAFf,CALU,CAYd,EAAyBC,IAAzB,CAA8B,SAASC,CAAT,CAAsB,CAChD,GAAIC,CAAAA,CAAU,CAAGD,CAAW,CAAC,CAAD,CAA5B,CACAL,CAAc,CAAGK,CAAW,CAAC,CAAD,CAA5B,CAEA,MAAOlB,CAAAA,CAAY,CAACoB,MAAb,CAAoB,CACvBC,KAAK,CAAEF,CADgB,CAEvBG,IAAI,CAAExB,CAAS,CAACyB,MAAV,CAAiB,gCAAjB,CAAmD,CAAC,UAAaX,CAAd,CAAyB,YAAeF,CAAxC,CAAnD,CAFiB,CAGvBc,IAAI,CAAExB,CAAY,CAACyB,KAAb,CAAmBC,WAHF,CAApB,CAKV,CATD,EASGT,IATH,CASQ,SAASU,CAAT,CAAgB,CACpBA,CAAK,CAACC,iBAAN,CAAwBf,CAAxB,EACAc,CAAK,CAACE,OAAN,GAAgBC,EAAhB,CAAmB7B,CAAW,CAAC8B,IAA/B,CAAqC,UAAW,CAE5C,GAAIC,CAAAA,CAAO,CAAGtC,CAAC,CAAC,UAAD,CAAD,CAAcuC,GAAd,EAAd,CACA,MAAOC,CAAAA,CAAa,CAACtB,CAAD,CAAYoB,CAAZ,CACvB,CAJD,EAOAL,CAAK,CAACE,OAAN,GAAgBC,EAAhB,CAAmB7B,CAAW,CAACkC,MAA/B,CAAuC,UAAW,CAE9CR,CAAK,CAACS,OAAN,EACH,CAHD,EAMAT,CAAK,CAACU,IAAN,EAGH,CA3BD,EA2BGC,KA3BH,CA2BS1C,CAAY,CAAC2C,SA3BtB,CA4BH,CA9CD,CA+CH,CAhDD,CAwDA,QAASL,CAAAA,CAAT,CAAuBtB,CAAvB,CAAkC4B,CAAlC,CAAwC,IAShCC,CAAAA,CAAW,CAAG,SATkB,CAUpC9C,CAAI,CAAC+C,IAAL,CAAU,CATI,CACVC,UAAU,CAAE,iCADF,CAEVC,IAAI,CAAE,CACFhC,SAAS,CAAEA,CADT,CAEF4B,IAAI,CAAEA,CAFJ,CAFI,CASJ,CAAV,EAAqB,CAArB,EAAwBvB,IAAxB,CAA6B,SAASN,CAAT,CAAe,CACxC,GAAIA,CAAJ,CAAU,CACN,MAAOd,CAAAA,CAAG,CAACgD,UAAJ,CAAe,gBAAf,CAAiC,kBAAjC,CACV,CACDJ,CAAW,CAAG,OAAd,CACA,MAAO5C,CAAAA,CAAG,CAACgD,UAAJ,CAAe,mBAAf,CAAoC,kBAApC,CAEV,CAPD,EAOG5B,IAPH,CAOQ,SAAS6B,CAAT,CAAkB,CACtB,GAAIC,CAAAA,CAAM,CAAG,IAAb,CACA,GAAmB,SAAf,EAAAN,CAAJ,CAA8B,CAC1BM,CAAM,CAAG,CACLC,EAAE,CAAEpC,CADC,CAELqC,SAAS,CAAEH,CAFN,CAIZ,CALD,IAKO,CACHC,CAAM,CAAG,CACLC,EAAE,CAAEpC,CADC,CAELsC,QAAQ,CAAEJ,CAFL,CAIZ,CAEDK,MAAM,CAACC,QAAP,CAAgBC,IAAhB,CAAuBtD,CAAG,CAACuD,WAAJ,CAAgB,sBAAhB,CAAwCP,CAAxC,IAE1B,CAvBD,EAuBGT,KAvBH,CAuBS1C,CAAY,CAAC2C,SAvBtB,CAwBH,CAED,MAAqD,CASjD,KAAQ,eAAW,CACf,MAAO,IAAInC,CAAAA,CACd,CAXgD,CAaxD,CAvIK,CAAN","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Module to manage content bank actions, such as delete or rename.\n *\n * @module     core_contentbank/actions\n * @package    core_contentbank\n * @copyright  2020 Sara Arjona <sara@moodle.com>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\ndefine([\n    'jquery',\n    'core/ajax',\n    'core/notification',\n    'core/str',\n    'core/templates',\n    'core/url',\n    'core/modal_factory',\n    'core/modal_events'],\nfunction($, Ajax, Notification, Str, Templates, Url, ModalFactory, ModalEvents) {\n\n    /**\n     * List of action selectors.\n     *\n     * @type {{DELETE_CONTENT: string}}\n     */\n    var ACTIONS = {\n        RENAME_CONTENT: '[data-action=\"renamecontent\"]',\n    };\n\n    /**\n     * Actions class.\n     */\n    var Actions = function() {\n        this.registerEvents();\n    };\n\n    /**\n     * Register event listeners.\n     */\n    Actions.prototype.registerEvents = function() {\n        $(ACTIONS.RENAME_CONTENT).click(function(e) {\n            e.preventDefault();\n\n            var contentname = $(this).data('contentname');\n            var contentid = $(this).data('contentid');\n\n            var strings = [\n                {\n                    key: 'renamecontent',\n                    component: 'core_contentbank'\n                },\n                {\n                    key: 'rename',\n                    component: 'core_contentbank'\n                },\n            ];\n\n            var saveButtonText = '';\n            Str.get_strings(strings).then(function(langStrings) {\n                var modalTitle = langStrings[0];\n                saveButtonText = langStrings[1];\n\n                return ModalFactory.create({\n                    title: modalTitle,\n                    body: Templates.render('core_contentbank/renamecontent', {'contentid': contentid, 'contentname': contentname}),\n                    type: ModalFactory.types.SAVE_CANCEL\n                });\n            }).then(function(modal) {\n                modal.setSaveButtonText(saveButtonText);\n                modal.getRoot().on(ModalEvents.save, function() {\n                    // The action is now confirmed, sending an action for it.\n                    var newname = $(\"#newname\").val();\n                    return renameContent(contentid, newname);\n                });\n\n                // Handle hidden event.\n                modal.getRoot().on(ModalEvents.hidden, function() {\n                    // Destroy when hidden.\n                    modal.destroy();\n                });\n\n                // Show the modal.\n                modal.show();\n\n                return;\n            }).catch(Notification.exception);\n        });\n    };\n\n    /**\n     * Rename content in the content bank.\n     *\n     * @param {int} contentid The content to rename.\n     * @param {string} name The new name for the content.\n     */\n    function renameContent(contentid, name) {\n        var request = {\n            methodname: 'core_contentbank_rename_content',\n            args: {\n                contentid: contentid,\n                name: name\n            }\n        };\n\n        var requestType = 'success';\n        Ajax.call([request])[0].then(function(data) {\n            if (data) {\n                return Str.get_string('contentrenamed', 'core_contentbank');\n            }\n            requestType = 'error';\n            return Str.get_string('contentnotrenamed', 'core_contentbank');\n\n        }).then(function(message) {\n            var params = null;\n            if (requestType == 'success') {\n                params = {\n                    id: contentid,\n                    statusmsg: message\n                };\n            } else {\n                params = {\n                    id: contentid,\n                    errormsg: message\n                };\n            }\n            // Redirect to the content view page and display the message as a notification.\n            window.location.href = Url.relativeUrl('contentbank/view.php', params, false);\n            return;\n        }).catch(Notification.exception);\n    }\n\n    return /** @alias module:core_contentbank/actions */ {\n        // Public variables and functions.\n\n        /**\n         * Initialise the unified user filter.\n         *\n         * @method init\n         * @return {Actions}\n         */\n        'init': function() {\n            return new Actions();\n        }\n    };\n});\n"],"file":"actions.min.js"}